/*! holiday-oh-nice           2015-04-22 */

(function(){var a,b,c,d,e,f;d=!1,b="https://www.google.com/calendar/ical/fr.french%23holiday%40group.v.calendar.google.com/public/basic.ics",e=null,f=null,a=null,c={color:"#3a87ad"},$(document).bind("keyup keydown",function(a){return d=a.shiftKey}),$(document).ready(function(){var c,g,h,i,j,k;return window._cal=g=$(".calendar").fullCalendar({header:{left:"",right:"prev,next today",center:"title"},firstDay:1,selectable:!0,selectHelper:!0,select:function(a,b,d){var e,f;if($(".delete-btn").hasClass("fc-state-down"))return void g.fullCalendar("unselect");for(e=a.clone(),f=[];e.diff(b,"days")<0;)c(e),f.push(e.add(1,"days"));return f},eventClick:function(a,b,c){var d,e;return window.e=a,e=h(),$(".delete-btn").hasClass("fc-state-down")?void(!a.className.length||"full"!==(d=a.className[0])&&"am"!==d&&"pm"!==d||(g.fullCalendar("removeEvents",function(b){return b===a}),j("full"===a.className[0]?e+1:e+.5))):(a.className.indexOf("full")>-1?(a.className=["am"],a.color="#88bcd6",a.title+=" (Matin)",j(e+.5)):a.className.indexOf("am")>-1?(a.className=["pm"],a.color="#6bb3d6",a.title=a.title.replace("Matin","Après-midi")):a.className.indexOf("pm")>-1&&e>.5?(j(e-.5),a.className=["full"],a.color="#3a87ad",a.title=a.title.replace(" (Après-midi)","")):a.className.indexOf("pm")>-1&&(a.className=["am"],a.color="#88bcd6",a.title=a.title.replace("Après-midi","Matin")),g.fullCalendar("updateEvent",a))},editable:!0,eventSources:[{url:b,color:"#ff724d",className:"holiday",editable:!1},{events:function(a,b,c,d){return $.ajax({url:"/events/from/"+a.utc().format().replace("+00:00","Z")+"/to/"+b.utc().format().replace("+00:00","Z"),dataType:"json",success:function(a){return d(a.events)}})},color:"#ffce4d",className:"server",editable:!1}]}),c=function(b){var c,e,i,k,l;return i=b.diff(moment(),"days")>-1&&0!==(k=b.day())&&6!==k&&0===g.fullCalendar("clientEvents",function(a){return 0===b.diff(moment(a.start),"days",!0)}).length,i||d?null===a||(l=h()-1,-.5>l)?void 0:(c=["full"],e=f,l===-.5&&(e+=" (Matin)",c=["am"],l=0),j(l),g.fullCalendar("renderEvent",{title:e,start:new Date(b.toDate()),allDay:!0,className:c},!0),g.fullCalendar("unselect")):void g.fullCalendar("unselect")},$(".calendar .fc-left").append($("<button>",{type:"button","class":"save-btn fc-button fc-state-default fc-corner-left fc-corner-right",text:"Sauvegarder"}).hover(function(){return $(this).addClass("fc-state-hover")},function(){return $(this).removeClass("fc-state-hover fc-state-down")}).mousedown(function(){return $(this).addClass("fc-state-down")}).mouseup(function(){return $(this).removeClass("fc-state-down")}).click(function(){var a,b,c,d,e,f,h,j,k;for(c=g.fullCalendar("clientEvents",function(a){var b;return"full"===(b=a.className[0])||"am"===b||"pm"===b}),a=[],d=0,f=c.length;f>d;d++)for(b=c[d],k="full"===b.className[0]?["am","pm"]:[b.className[0]],e=0,h=k.length;h>e;e++)j=k[e],a.push({day:b.start.utc().format().replace("+00:00","Z"),type:j,slot:i(b.title.split("(")[0].trim())});return a.length&&$.ajax({url:"/events/save",data:{events:JSON.stringify(a)},type:"POST",success:function(){return location.reload()}}),!1}),$("<button>",{type:"button","class":"delete-btn fc-button fc-state-default fc-corner-left fc-corner-right",text:"Mode suppression"}).hover(function(){return $(this).addClass("fc-state-hover")},function(){return $(this).removeClass("fc-state-hover")}).mousedown(function(){return $(this).toggleClass("fc-state-down")})),h=function(){return parseFloat(a.attr("data-remaining"))},j=function(b){return a.attr("data-remaining",b),$(".remaining").text(b)},i=function(a){var b,c,d,e;for(e=$(".slot option"),b=0,c=e.length;c>b;b++)if(d=e[b],$(d).text()===a)return $(d).attr("value")},k=function(){return e=$(this).val(),a=$(this).find("option[value="+e+"]"),f=a.text(),$(".remaining").text(a.attr("data-remaining"))},k.call($(".slot")),$(".slot").change(k)})}).call(this);
//# sourceMappingURL=main.min.js.map